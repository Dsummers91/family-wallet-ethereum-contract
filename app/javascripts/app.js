'use strict'

import Web3 from 'web3';

var web3 = new Web3();

web3.setProvider(new web3.providers.HttpProvider('http://localhost:8545'));

var abi = [{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"getChild","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"approveRefund","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"getChildsAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"refundBalance","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"string"}],"name":"getDefaultAllowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"force","type":"bool"}],"name":"nextAllowancePeriod","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"getAllowance","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"getAllowanceAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"inputs":[{"name":"adults","type":"address[]"},{"name":"children","type":"address[]"},{"name":"defaultAllowanceInEther","type":"uint256"},{"name":"durationInDays","type":"uint256"},{"name":"firstAllowancePayment","type":"bool"}],"payable":false,"type":"constructor"},{"payable":true,"type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"payment","type":"uint256"},{"indexed":false,"name":"sender","type":"address"}],"name":"MoneyReceived","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"allowance","type":"uint256"},{"indexed":false,"name":"receiver","type":"address"}],"name":"AllowancePaid","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"start","type":"uint256"},{"indexed":false,"name":"end","type":"uint256"}],"name":"NewAllowancePeriod","type":"event"}]

var Contract = web3.eth.contract(abi);

var adults = [web3.eth.accounts[0], web3.eth.accounts[1]];
var children = [web3.eth.accounts[2], web3.eth.accounts[3], web3.eth.accounts[4]];
var defaultAllowanceInEth = 15;
var durationInDays = 1;
var includeFirstAllowance = 1;

var data = "0x6060604081905260008054600160a060020a0319166c01000000000000000000000000308102041790556109cf3881900390819083398101604052805160805160a05160c05160e051938501949290920192909190604080516060818101835260008083526020808401829052838501829052845192830185528183528201819052928101839052670de0b6b3a7640000860260055582905b885184101561011757888481518110156100025760209081029091010151600160a060020a031683526001805480820180835582818380158290116101ba576002028160020283600052602060002091820191016101ba91905b80821115610261578054600160a860020a0319168155600060018201556002016100f2565b600091505b87518210156102655787828151811015610002576020908102909101810151600160a060020a0316908201526005548152841561015c5760055460408201525b600280546001810180835582818380158290116102915760030281600302836000526020600020918201910161029191905b80821115610261576000808255600182018054600160a060020a0319169055600282015560030161018e565b505050919090600052602060002090600202016000508451815460208701517f010000000000000000000000000000000000000000000000000000000000000090810204740100000000000000000000000000000000000000000260a060020a60ff02196c0100000000000000000000000093840293909304600160a060020a03199092169190911791909116178155604085015160019091015550600190930192610098565b5090565b4260038190556201518087026006819055016004555050505050505050506106db806102f46000396000f35b505050919090600052602060002090600302016000508251815560208301516001820180546c0100000000000000000000000092830292909204600160a060020a031990921691909117905560408301516002909101555060019091019061011c566060604052361561006c5760e060020a600035046325a10a7081146100f757806335a9731b146101be57806348c20a24146102ab57806356c8e12e146102c157806378ea787b1461034d57806380aab099146103a5578063973e9b8b146103d0578063f8ba8e6a1461043f575b61045534610457335b60408051606081018252600080825260208201819052918101829052906001548110156104e957600180548290811015610002579060005260206000209060020201600050604080516060810182528254600160a060020a038116825260ff60a060020a90910416151560208201526001909201549082015291505b50919050565b34610002576104a760043560006104ee825b60408051606081018252600080825260208201819052918101829052905b6002548110156104e95782600160a060020a0316600260005082815481101561000257906000526020600020906003020160005060010154600160a060020a031614156106d35760028054829081101561000257906000526020600020906003020160005060408051606081018252825481526001830154600160a060020a031660208201526002909201549082015291506100f1565b34610002576104556000805b6001548110156104f9576001805482908110156100025790600052602060002090600202016000505433600160a060020a03908116911614156104fd57600091505b6001548210156104fd576001805483908110156100025790600052602060002090600202016000505433600160a060020a03908116911614156102a05760016001600050838154811015610002579060005260206000209060020201600050805460f860020a9283029290920460a060020a0274ff0000000000000000000000000000000000000000199092169190911790555b60019091019061020c565b34610002576104c3600435600061050582610109565b346100025761045560043560005b6001548110156104f9576001805482908110156100025790600052602060002090600202016000505433600160a060020a0390811691161415610510576000805b6001548210156105185760018054839081101561000257906000526020600020906002020160005054600160a060020a0316905061052181610075565b34610002576104c36004808035906020019082018035906020019191908080601f016020809104026020016040519081016040528093929190818152602001838380828437509496505050505050506005545b919050565b34610002576104d560043560006000600460005054421080156103c6575082155b1561057257610002565b346100025761045560408051606081018252600080825260208201819052918101829052905b6002548110156104f9576002805482908110156100025790600052602060002090600302016000506001015433600160a060020a03908116911614156106735761067b33610109565b34610002576104c360043560006106c882610109565b005b604090810180519092019091528051348152600160a060020a033316602082015281517fd5bacf16311467b33e67187f3405b00d326f1e41e65827ebf70778d78a1976ad929181900390910190a1565b60408051600160a060020a039092168252519081900360200190f35b60408051918252519081900360200190f35b604080519115158252519081900360200190f35b610002565b6020015190506103a0565b5050565b6001016101ca565b5190506103a0565b50505b6001016102cf565b61053b33610075565b60200151151561053057610002565b600190910190610310565b5160008054604051600160a060020a03938416936108fc92163180159290920292818181858888f193505050501561050d57610002565b5060048054600381905560065401905560005b6002548110156105de576002805482908110156100025790600052602060002090600302016000505460028054839081101561000257906000526020600020906003020160005060020180549091019055600101610585565b60035460045460408051928352602083019190915280517f58d49b6b50144f013b9698e664a672ceec3d600ef03ad4102438fb5357dd8d3e9281900390910190a1600191506100f1565b600060408084018290528051918252600160a060020a033316602083015280517f9641e6676c9ab7ee44cde0264acc9d0f752f29da8806ad32a0907ff4f45881f39281900390910190a15b6001016103f6565b915081604001516000141561068f57610002565b60208201516040808401519051600160a060020a039092169181156108fc0291906000818181858888f193505050501561062857610002565b6040015190506103a0565b60010161012756";
var familyWallet = Contract.new(adults, children, defaultAllowanceInEth,durationInDays, includeFirstAllowance, {from: web3.eth.accounts[0], data: data,gas:2000000}, function(err, res) {
  console.log(res);
  var moneyReceived = familyWallet.MoneyReceived(null, {fromBlock:0, toBlock: 'latest'});
})

console.log(Contract);

window.fam = familyWallet;



moneyReceived.watch((err, res) => {
  console.log(res);
})